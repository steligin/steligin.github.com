<!doctype html>
<html lang="en">
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<title>Super Brick Game Color Advance: Matrix Rain</title>
<style>
    @font-face {
        font-family: PressStart2P;
        src: url(PressStart2P.ttf);
    }
    body {
        background-color: #000000;
        color: #ffffff;
        font-family: "PressStart2P";
        font-size1: 12px;
    }
    canvas {
        display: block;
        position: absolute;
        border: 1px solid #000000; 
        margin: auto;
        top: 0;
        bottom: 0;
        right: 0;
        left: 0;
    }
</style>
</head>
<body>

<center>
<button onclick="runMatrix()">run</button>
<button onclick="stopMatrix()">stop</button>
</center>

<script>

var COLS = 20;
var ROWS = 20;
var TILE_WIDTH = 20;
var SCOREBOARD_WIDTH = 100;

var CANVAS_BGCOLOR = "#b1c2b1";

canvas = document.createElement("canvas");
ctx = canvas.getContext("2d");
canvas.width = COLS*TILE_WIDTH+SCOREBOARD_WIDTH;
canvas.height = ROWS*TILE_WIDTH;
//canvas.style.backgroundColor = CANVAS_BGCOLOR;
canvas.style.backgroundColor = "#000000";

document.body.appendChild(canvas);

ctx.fillStyle = "#000000";
ctx.lineWidth = 1;
ctx.beginPath();
ctx.moveTo(canvas.width-SCOREBOARD_WIDTH+0.5, 0+0.5);
ctx.lineTo(canvas.width-SCOREBOARD_WIDTH+0.5, canvas.height+0.5);
ctx.stroke();

//making the canvas full screen
// canvas.width = window.innerWidth;
// canvas.height = window.innerHeight;

//chinese characters - taken from the unicode charset
//var symbols = "0123456789ABCDEF";
//var symbols = "АБВГДЕЁЖЗИЙКЛМНОПРСТУФХЦЧШЩЪЫЬЭЮЯ";

//converting the string into an array of single characters
//symbols = symbols.split("");

var font_size = 20;
//number of columns for the rain
var columns = (canvas.width)/font_size;
//var columns = (canvas.width)/font_size;
//an array of drops - one per column
var drops = [];
//x below is the x coordinate
//1 = y co-ordinate of the drop(same for every drop initially)
for (var x = 0; x < columns; x++) {
    //drops[x] = 1;
    drops[x] = 0;
}

var colorArray = [
    "#ff0000",
    "#ff9900",
    "#ffff00",
    "#00ff00",
    "#0099ff",
    "#0000ff",
    "#9900ff"
];

//drawing the characters
function draw() {
    //Black BG for the canvas
    //translucent BG to show trail
    ctx.fillStyle = "rgba(0, 0, 0, 0.05)";
    //ctx.fillStyle = "#000000";
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    
    //ctx.fillStyle = "#00ff00"; //green text
    //ctx.font = font_size + "px PressStart2P";
    //ctx.fillStyle = colorArray[Math.floor(Math.random() * (colorArray.length))];

    //looping over drops
    for(var i = 0; i < drops.length; i++) {
        //a random symbols character to print
        //var text = symbols[Math.floor(Math.random()*symbols.length)];

        //x = i*font_size, y = value of drops[i]*font_size
        //ctx.fillText(text, i*font_size, drops[i]*font_size);
        ctx.fillStyle = colorArray[Math.floor(Math.random() * (colorArray.length))];
        ctx.clearRect(i*font_size, drops[i]*font_size, font_size, font_size);
        ctx.fillRect(i*font_size+1, drops[i]*font_size+1, font_size-2, font_size-2);
        ctx.clearRect(i*font_size+4, drops[i]*font_size+4, font_size-8, font_size-8);
        ctx.fillRect(i*font_size+6, drops[i]*font_size+6, font_size-12, font_size-12);

        //sending the drop back to the top randomly after it has crossed the screen
        //adding a randomness to the reset to make the drops scattered on the Y axis
        if(drops[i]*font_size > canvas.height && Math.random() > 0.975) {
            //drops[i] = 0;
            drops[i] = -1;
        }
        
        //incrementing Y coordinate
        drops[i]++;
    }
}

// 1000/17 = ~60 times a second
// 1000/33 = ~30 times a second
// 1000/50 = ~20 times a second
// 1000/65 = ~15 times a second
// setInterval(draw, 50);

function runMatrix() {
    if (typeof Game_Interval != "undefined") {
        clearInterval(Game_Interval);
    }
    Game_Interval = setInterval(draw, 65);
    console.log("run_matrix");
}

function stopMatrix() {
    clearInterval(Game_Interval);
    console.log("stop_matrix");
}

runMatrix();

</script>

</body>
</html>